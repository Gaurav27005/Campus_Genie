<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost and Found - Find Items</title>
    <link rel="icon" type="image/png" href="/Assets/favicon.ico">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="find-items.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <a href="index.html" class="Genie"><img src="/Assets/favicon.ico" alt="Genie"></a>
        <a href="index.html" class="brand">Campus Genie</a>
        <nav class="navbar">
            <div class="nav-left">
                <!-- Login button removed, contact us button placed here instead -->
                <a href="contact.html" class="contact-btn">Contact Us</a>
            </div>
            <div class="nav-right">
                <!-- Contact us button removed from here -->
            </div>
        </nav>
    </header>
    <div class="back-button-container">
        <a href="javascript:history.back()" class="back-button">
            <i class="fas fa-arrow-left"></i> Go Back
        </a>
    </div>

    <main>
        <h1 class="section-title">Lost and Found Corner</h1>
        
        <!-- Removed the lost-found-box section -->
        
        <div class="items-grid" id="items-container">
            <!-- Items will be loaded dynamically from JSON -->
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Campus Genie. All Rights Reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const itemsContainer = document.getElementById('items-container');
            
            // Fetch items from MongoDB
            fetch('/api/items')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(items => {
                    // Clear any existing content
                    itemsContainer.innerHTML = '';
                    
                    if (items.length === 0) {
                        // No items found
                        const noItemsMessage = document.createElement('div');
                        noItemsMessage.className = 'no-items-message';
                        noItemsMessage.innerHTML = `
                            <h3>No Items Found</h3>
                            <p>There are currently no lost or found items listed.</p>
                            <p>Be the first to <a href="post-item.html">post an item</a>!</p>
                        `;
                        
                        itemsContainer.appendChild(noItemsMessage);
                    } else {
                        // Loop through the items and create HTML for each
                        items.forEach(item => {
                            const itemCard = document.createElement('div');
                            itemCard.className = 'item-card';
                            
                            // Create the HTML structure for each item
                            itemCard.innerHTML = `
                                <div class="img-container">
                                    <img src="${item.image}" alt="${item.title}">
                                </div>
                                <div class="content">
                                    <h3>${item.type === 'lost' ? 'Lost: ' : 'Found: '}${item.title}</h3>
                                    <p>${item.description}</p>
                                    <p class="item-details">
                                        <span class="location">üìç ${item.location || 'Location not specified'}</span>
                                        <span class="date">üìÖ ${formatDate(item.date)}</span>
                                        ${item.contact ? `<span class="contact">üìû ${item.contact}</span>` : ''}
                                    </p>
                                </div>
                            `;
                            
                            // Add the item card to the container
                            itemsContainer.appendChild(itemCard);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching items:', error);
                    
                    // If MongoDB fetch fails, try to get items from localStorage
                    const postedItems = JSON.parse(localStorage.getItem('postedItems') || '[]');
                    
                    // Clear any existing content
                    itemsContainer.innerHTML = '';
                    
                    if (postedItems.length === 0) {
                        // No items found in localStorage either
                        const noItemsMessage = document.createElement('div');
                        noItemsMessage.className = 'no-items-message';
                        noItemsMessage.innerHTML = `
                            <h3>No Items Found</h3>
                            <p>There are currently no lost or found items listed.</p>
                            <p>Be the first to <a href="post-item.html">post an item</a>!</p>
                        `;
                        
                        itemsContainer.appendChild(noItemsMessage);
                    } else {
                        // Display items from localStorage
                        postedItems.forEach(item => {
                            const itemCard = document.createElement('div');
                            itemCard.className = 'item-card';
                            
                            itemCard.innerHTML = `
                                <div class="img-container">
                                    <img src="${item.image}" alt="${item.title}">
                                </div>
                                <div class="content">
                                    <h3>${item.type === 'lost' ? 'Lost: ' : 'Found: '}${item.title}</h3>
                                    <p>${item.description}</p>
                                    <p class="item-details">
                                        <span class="location">üìç ${item.location || 'Location not specified'}</span>
                                        <span class="date">üìÖ ${formatDate(item.date)}</span>
                                        ${item.contact ? `<span class="contact">üìû ${item.contact}</span>` : ''}
                                    </p>
                                </div>
                            `;
                            
                            itemsContainer.appendChild(itemCard);
                        });
                    }
                });
        });
        
        // Helper function to format dates
        function formatDate(dateString) {
            if (!dateString) return 'Date not specified';
            
            const date = new Date(dateString);
            if (isNaN(date)) return dateString;
            
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
    </script>
</body>
</html>