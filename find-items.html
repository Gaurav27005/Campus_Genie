<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost and Found - Find Items</title>
    <link rel="icon" type="image/png" href="/Assets/favicon.ico">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="find-items.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <a href="index.html" class="Genie"><img src="/Assets/favicon.ico" alt="Genie"></a>
        <a href="index.html" class="brand">Campus Genie</a>
        <nav class="navbar">
            <div class="nav-left">
                <a href="login.html" class="login-btn">Login</a>
            </div>
        </nav>
    </header>
    <div class="back-button-container">
        <a href="javascript:history.back()" class="back-button">
            <i class="fas fa-arrow-left"></i> Go Back
        </a>
    </div>

    <main>
        <h1 class="section-title">Lost and Found Corner</h1>
        
        <!-- Removed the lost-found-box section -->
        
        <div class="items-grid" id="items-container">
            <!-- Items will be loaded dynamically from JSON -->
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-brand">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <img src="/Assets/noto_man-genie.png" alt="Campus Genie Logo">
                    <h2>Campus Genie</h2>
                </div>
                <div class="footer-brand-content">
                    <p>Simplifying student life by providing essential resources and fostering a connected campus community. Your one-stop solution for all campus needs.</p>
                </div>
            </div>
            <div class="footer-info">
                <div class="footer-section">
                    <div class="icon">üìß</div>
                    <a href="mailto:CampusGenie19@gmail.com">CampusGenie19@gmail.com</a>
                </div>
                <div class="footer-section">
                    <div class="icon">üìç</div>
                    <a href="https://www.google.com/maps/place/Akurdi,+Pune,+Maharashtra+412101" target="_blank">
                        Akurdi, Pune 412101
                    </a>
                </div>
                <div class="footer-section">
                    <div class="icon">üìû</div>
                    <a href="tel:+917020000000">+91 7020000000</a>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 Campus Genie. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (token && user) {
                // Get user's first initial
                const userInitial = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                
                // Replace login button with user avatar
                const navLeft = document.querySelector('.nav-left');
                navLeft.innerHTML = ''; // Clear the login button
                
                // Create user avatar element
                const userAvatar = document.createElement('div');
                userAvatar.className = 'user-avatar';
                userAvatar.textContent = userInitial;
                navLeft.appendChild(userAvatar);
                
                // Create dropdown menu
                const dropdownMenu = document.createElement('div');
                dropdownMenu.className = 'dropdown-menu';
                
                // Add logout option
                const logoutOption = document.createElement('a');
                logoutOption.href = '#';
                logoutOption.className = 'dropdown-item';
                logoutOption.textContent = 'Logout';
                logoutOption.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.href = '/';
                });
                
                dropdownMenu.appendChild(logoutOption);
                navLeft.appendChild(dropdownMenu);
                
                // Toggle dropdown on avatar click
                userAvatar.addEventListener('click', function() {
                    dropdownMenu.classList.toggle('show');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!userAvatar.contains(e.target) && !dropdownMenu.contains(e.target)) {
                        dropdownMenu.classList.remove('show');
                    }
                });
            }
            
            const itemsContainer = document.getElementById('items-container');
            
            // Fetch items from MongoDB
            fetch('/api/items')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(items => {
                    // Clear any existing content
                    itemsContainer.innerHTML = '';
                    
                    if (items.length === 0) {
                        // No items found
                        const noItemsMessage = document.createElement('div');
                        noItemsMessage.className = 'no-items-message';
                        noItemsMessage.innerHTML = `
                            <h3>No Items Found</h3>
                            <p>There are currently no lost or found items listed.</p>
                            <p>Be the first to <a href="post-item.html">post an item</a>!</p>
                        `;
                        
                        itemsContainer.appendChild(noItemsMessage);
                    } else {
                        // Loop through the items and create HTML for each
                        items.forEach(item => {
                            const itemCard = document.createElement('div');
                            itemCard.className = 'item-card';
                            
                            // Create the HTML structure for each item
                            itemCard.innerHTML = `
                                <div class="img-container">
                                    <img src="${item.image}" alt="${item.title}">
                                </div>
                                <div class="content">
                                    <h3>${item.type === 'lost' ? 'Lost: ' : 'Found: '}${item.title}</h3>
                                    <p>${item.description}</p>
                                    <p class="item-details">
                                        <span class="location">üìç ${item.location || 'Location not specified'}</span>
                                        <span class="date">üìÖ ${formatDate(item.date)}</span>
                                        ${item.contact ? `<span class="contact">üìû ${item.contact}</span>` : ''}
                                    </p>
                                </div>
                            `;
                            
                            // Add the item card to the container
                            itemsContainer.appendChild(itemCard);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching items:', error);
                    
                    // If MongoDB fetch fails, try to get items from localStorage
                    const postedItems = JSON.parse(localStorage.getItem('postedItems') || '[]');
                    
                    // Clear any existing content
                    itemsContainer.innerHTML = '';
                    
                    if (postedItems.length === 0) {
                        // No items found in localStorage either
                        const noItemsMessage = document.createElement('div');
                        noItemsMessage.className = 'no-items-message';
                        noItemsMessage.innerHTML = `
                            <h3>No Items Found</h3>
                            <p>There are currently no lost or found items listed.</p>
                            <p>Be the first to <a href="post-item.html">post an item</a>!</p>
                        `;
                        
                        itemsContainer.appendChild(noItemsMessage);
                    } else {
                        // Display items from localStorage
                        postedItems.forEach(item => {
                            const itemCard = document.createElement('div');
                            itemCard.className = 'item-card';
                            
                            itemCard.innerHTML = `
                                <div class="img-container">
                                    <img src="${item.image}" alt="${item.title}">
                                </div>
                                <div class="content">
                                    <h3>${item.type === 'lost' ? 'Lost: ' : 'Found: '}${item.title}</h3>
                                    <p>${item.description}</p>
                                    <p class="item-details">
                                        <span class="location">üìç ${item.location || 'Location not specified'}</span>
                                        <span class="date">üìÖ ${formatDate(item.date)}</span>
                                        ${item.contact ? `<span class="contact">üìû ${item.contact}</span>` : ''}
                                    </p>
                                </div>
                            `;
                            
                            itemsContainer.appendChild(itemCard);
                        });
                    }
                });
        });
        
        // Helper function to format dates
        function formatDate(dateString) {
            if (!dateString) return 'Date not specified';
            
            const date = new Date(dateString);
            if (isNaN(date)) return dateString;
            
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
    </script>